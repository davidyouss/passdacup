<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scoreboard | Pass Da Cup</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-black text-white p-6 font-sans">
    <div class="max-w-md mx-auto space-y-6">
        
        <div class="bg-gray-900 border border-yellow-500/20 p-4 rounded-2xl shadow-inner text-center">
            <p class="text-[10px] font-black uppercase text-gray-500 tracking-[0.2em] mb-1">Live Feed</p>
            <div id="pbp-display" class="text-lg font-bold italic text-yellow-500 leading-tight">
                Waiting for the first pitch...
            </div>
        </div>

        <div class="bg-green-600 p-8 rounded-3xl text-center shadow-2xl shadow-green-900/20 border-b-8 border-green-800">
            <p class="text-[10px] font-black uppercase text-green-100 mb-1 tracking-widest">Current Pot</p>
            <h1 id="pot" class="text-6xl font-black italic tracking-tighter">$0.00</h1>
        </div>

        <div class="space-y-3">
            <p class="text-[10px] font-bold text-gray-500 uppercase tracking-widest border-b border-gray-800 pb-2">Fielding Lineup</p>
            <div id="player-list" class="space-y-2">
                </div>
        </div>
    </div>

    <script>
        const S_URL = 'https://yhywgwohyzrcbzgxxtyb.supabase.co';
        const S_KEY = 'sb_publishable_zYteMuxmxLbR0mxUDe8a3w_8brmZ2sv';
        const sb = supabase.createClient(S_URL, S_KEY);

        const urlParams = new URLSearchParams(window.location.search);
        const gameId = urlParams.get('id');

        if (!gameId) {
            document.body.innerHTML = `<div class="flex h-screen items-center justify-center text-gray-500 font-bold uppercase tracking-tighter text-xl italic">No Game Found</div>`;
        } else {
            initScoreboard();
        }

        async function initScoreboard() {
            // Initial Data Load
            const { data } = await sb.from('games').select('*').eq('id', gameId).single();
            if (data) render(data);

            // Real-time listener for updates
            sb.channel('game_updates')
                .on('postgres_changes', { event: 'UPDATE', schema: 'public', table: 'games', filter: `id=eq.${gameId}` }, 
                payload => render(payload.new))
                .subscribe();
        }

        function render(game) {
            // Update Pot
            document.getElementById('pot').innerText = `$${parseFloat(game.pot_total).toFixed(2)}`;
            
            // Update Live Feed
            if (game.last_event) {
                document.getElementById('pbp-display').innerText = game.last_event;
            }

            // Update Player List
            const list = document.getElementById('player-list');
            list.innerHTML = game.players.map((p, i) => `
                <div class="flex items-center justify-between p-4 rounded-2xl border-2 ${i === game.current_holder_index ? 'bg-blue-600 border-blue-400 shadow-lg scale-105' : 'bg-gray-900 border-gray-800 opacity-60'} transition-all duration-300">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-full bg-black/20 flex items-center justify-center font-black text-xs">
                            ${i === game.current_holder_index ? 'üç∫' : i + 1}
                        </div>
                        <span class="font-black uppercase italic tracking-tighter text-lg">${p.name}</span>
                    </div>
                    <div class="text-right">
                        <p class="text-[10px] font-bold text-white/50 uppercase leading-none">Balance</p>
                        <p class="font-mono font-bold ${p.balance < 0 ? 'text-red-400' : 'text-green-400'}">
                            ${p.balance < 0 ? '-' : ''}$${Math.abs(p.balance).toFixed(2)}
                        </p>
                    </div>
                </div>
            `).join('');
        }
    </script>
</body>
</html>
