<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scoreboard | Pass The Cup</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-black text-white p-4 font-sans min-h-screen">
    <div class="max-w-md mx-auto space-y-4">
        
        <div class="text-center bg-gray-900 p-8 rounded-3xl border border-gray-800 shadow-2xl">
            <p class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Cup Balance</p>
            <h2 id="pot-display" class="text-7xl font-black text-green-400 tracking-tighter">$0.00</h2>
        </div>

        <div id="action-box" class="bg-gray-900/50 border border-gray-800 p-3 rounded-xl text-center hidden">
            <p id="last-event" class="text-yellow-500 font-bold italic text-[11px] uppercase tracking-tight"></p>
        </div>

        <div id="holder-card" class="bg-blue-600 rounded-2xl p-6 shadow-xl border-b-4 border-blue-800">
            <p class="text-[10px] font-black uppercase text-blue-100 tracking-widest leading-none mb-1">Currently Holding Cup</p>
            <h3 id="current-name" class="text-4xl font-black uppercase italic tracking-tight">WAITING...</h3>
        </div>

        <div id="player-list" class="space-y-2 pb-10"></div>
    </div>

    <script>
        const S_URL = 'https://yhywgwohyzrcbzgxxtyb.supabase.co';
        const S_KEY = 'sb_publishable_zYteMuxmxLbR0mxUDe8a3w_8brmZ2sv';
        const sb = supabase.createClient(S_URL, S_KEY);

        const params = new URLSearchParams(window.location.search);
        const r_id = params.get('id') ? params.get('id').toUpperCase() : null;

        async function start() {
            if (!r_id) return;
            let { data: g } = await sb.from('games').select('*').eq('id', r_id).single();
            if (g) render(g);

            sb.channel('updates').on('postgres_changes', { event: 'UPDATE', schema: 'public', table: 'games', filter: `id=eq.${r_id}` }, p => render(p.new)).subscribe();
        }

        function render(g) {
            document.getElementById('pot-display').innerText = `$${parseFloat(g.pot_total).toFixed(2)}`;
            
            if (g.last_event) {
                document.getElementById('action-box').classList.remove('hidden');
                document.getElementById('last-event').innerText = g.last_event;
            }

            const list = g.players;
            const idx = g.current_holder_index;
            document.getElementById('current-name').innerText = list[idx].name;

            document.getElementById('player-list').innerHTML = list.map((p, i) => `
                <div class="flex justify-between p-4 rounded-xl border ${i === idx ? 'bg-blue-900/40 border-blue-500' : 'bg-gray-900 border-gray-800'}">
                    <span class="font-bold uppercase text-xs">${p.name}</span>
                    <span class="font-mono font-bold ${p.balance >= 0 ? 'text-green-400' : 'text-red-500'}">
                        ${p.balance >= 0 ? '+' : ''}${parseFloat(p.balance).toFixed(2)}
                    </span>
                </div>
            `).join('');
        }
        start();
    </script>
</body>
</html>
